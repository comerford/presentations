\documentclass[letter]{article}
% generated by Docutils <http://docutils.sourceforge.net/>
\usepackage{fixltx2e} % LaTeX patches, \textsubscript
\usepackage{cmap} % fix search and cut-and-paste in Acrobat
\usepackage{ifthen}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\setcounter{secnumdepth}{0}

%%% Custom LaTeX preamble
\usepackage{fullpage} \usepackage{parskip} \usepackage{fancyhdr} \usepackage{graphicx} \pagestyle{fancy} \renewcommand{\headrulewidth}{0pt} \renewcommand{\footrulewidth}{0pt}

%%% User specified packages and stylesheets

%%% Fallback definitions for Docutils-specific commands

% hyperlinks:
\ifthenelse{\isundefined{\hypersetup}}{
  \usepackage[colorlinks=true,linkcolor=blue,urlcolor=blue]{hyperref}
  \urlstyle{same} % normal text font (alternatives: tt, rm, sf)
}{}
\hypersetup{
  pdftitle={General Ops Notes},
}

%%% Title Data
\title{\phantomsection%
  General Ops Notes%
  \label{general-ops-notes}}
\author{}
\date{}

%%% Body
\begin{document}
\maketitle


\section{Getting a single instance started%
  \label{getting-a-single-instance-started}%
}

Need a directory for data files:
%
\begin{quote}{\ttfamily \raggedright \noindent
mkdir~/data/db
}
\end{quote}

Start up mongod:
%
\begin{quote}{\ttfamily \raggedright \noindent
mongod~-{}-dbpath~/data/db
}
\end{quote}

Things to add in production. Use mongod -{}-help for all options:
%
\begin{quote}{\ttfamily \raggedright \noindent
-{}-logpath,~-{}-logappend,~-{}-fork,~-{}-rest,~-{}-port,~...
}
\end{quote}

Use a config file:
%
\begin{quote}{\ttfamily \raggedright \noindent
dbpath~=~/data/db\\
logpath~=~/path/to/logfile\\
logappend~=~true\\
fork~=~true\\
rest~=~true\\
port~=~27018
}
\end{quote}

Then use from the command line:
%
\begin{quote}{\ttfamily \raggedright \noindent
mongod~-{}-config~/path/to/config/file
}
\end{quote}

Connect using the mongo shell:
%
\begin{quote}{\ttfamily \raggedright \noindent
mongo
}
\end{quote}

Generate some data:
%
\begin{quote}{\ttfamily \raggedright \noindent
use~training\\
~\\
for(i=0;~i<10000;~i++)~\{\\
~~{[}'quiz',~'essay',~'exam'{]}.forEach(function(name)~\{\\
~~~~~var~score~=~Math.floor(Math.random()~*~50)~+~50;\\
~~~~~db.scores.insert(\{student:~i,~name:~name,~score:~score\});\\
~~\});\\
\}
}
\end{quote}


\section{Monitoring%
  \label{monitoring}%
}

Important tools:
%
\begin{quote}{\ttfamily \raggedright \noindent
mongostat~(-{}-discover)\\
iostat~-x~2\\
http://localhost:<1000~greater~than~-{}-port>\\
mms.10gen.com
}
\end{quote}

Getting stats from the shell:
%
\begin{quote}{\ttfamily \raggedright \noindent
db.serverStatus()\\
db.stats()\\
db.<collection~name>.stats()\\
~\\
\#~Do~this~in~another~shell~to~generate~load\\
db.foo.drop()\\
for~(var~i=0;~i<10000;~i++)\{\\
~~~~db.foo.insert(\{\_id:~i\});\\
~~~~for~(var~j=0;~j<~10;~j++)\{\\
~~~~~~~~db.foo.findOne(\{\_id:~(i-j)\});\\
~~~~\}\\
\}
}
\end{quote}

See what the server is currently doing:
%
\begin{quote}{\ttfamily \raggedright \noindent
db.currentOp()\\
db.killOp()\\
~\\
\#~Start~a~db.repairDatabase(),~find~it~in~currentOp,~then~kill~with~killOp.
}
\end{quote}

Plugins for external tools:
%
\begin{quote}{\ttfamily \raggedright \noindent
Munin,~Nagios,~Cacti,~Ganglia
}
\end{quote}


\section{Backup%
  \label{backup}%
}

For backup/restore on a live system:
%
\begin{quote}{\ttfamily \raggedright \noindent
mongodump~-d~<database>~-c~<collection>~...\\
mongorestore~-d~<database>~-c~<collection>~...
}
\end{quote}

You can also copy/rsync/snapshot the data files:
%
\begin{quote}{\ttfamily \raggedright \noindent
\#~Make~sure~you~lock~the~db~first\\
db.fsyncLock()\\
db.fsyncUnlock()\\
~\\
\#~On~MongoDB~pre~2.0\\
db.runCommand(\{fsync:~1,~lock:~1\})\\
db.\$cmd.sys.unlock.findOne()
}
\end{quote}

Usually you want to do backups from a slave/secondary.

\end{document}
